name: Secure Deployment Flow

on:
  workflow_dispatch: # 手動トリガーを許可

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Build Application
        run: echo "App build simulation completed."

  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment: production

    permissions:
      contents: read
      deployments: write

    steps:
      - name: Check Environment Protection
        run: echo "Checking if environment protection is active..."

      - name: Deploy to Production
        run: |
          echo "Starting deployment to $ environment..."
          echo "Using API Key: ${{ secrets.DEPLOY_API_KEY }}"

      - name: Deployment Complete
        run: echo "Deployment finished successfully."
