name: Step Setting Practice # ステップ設定の練習
on:
  workflow_dispatch:

jobs:
  working-directory:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: First step in root
        run: pwd

      - name: Second step in src directory
        working-directory: ./src
        run: pwd

      - name: Third step in test directory
        working-directory: ./test
        run: pwd

      - name: Multiple commands
        run: |
          echo "First command"
          mkdir build
          cd build
          echo "Current directory: $(pwd)"

      - name: Run with bash
        shell: bash
        run: |
          echo "Running with bash"
          echo "Current shell: $SHELL"

      - name: Run with sh
        shell: sh
        run: |
          echo "Running with sh"
          echo "Current directory: $(pwd)"

      - name: Run with python
        shell: python
        run: |
          import sys
          print(f"Python version: {sys.version}")

      - name: Set multiple outputs
        id: set-values
        run: |
          echo "name=John Doe" >> $GITHUB_OUTPUT
          echo "age=30" >> $GITHUB_OUTPUT
          echo "location=Tokyo" >> $GITHUB_OUTPUT

      - name: Use multiple outputs
        run: |
          echo "Name: ${{ steps.set-values.outputs.name }}"
          echo "Age: ${{ steps.set-values.outputs.age }}"
          echo "Location: ${{ steps.set-values.outputs.location }}"

  dynamic-values:
    runs-on: ubuntu-latest
    steps:
      - name: Generate timestamp
        id: timestamp
        run: echo "time=$(date +'%Y-%m-%d_%H-%M-%S')" >> $GITHUB_OUTPUT

      - name: Create file with timestamp
        run: |
          echo "Creating file at ${{ steps.timestamp.outputs.time }}"
          touch "backup_${{ steps.timestamp.outputs.time }}.txt"

  basic-error-handling:
    runs-on: ubuntu-latest
    steps:
      - name: Step that might fail
        continue-on-error: true
        run: |
          echo "Attempting risky operation"
          exit 1

      - name: Next step
        run: echo "This step will run even if the previous step failed"

  error-response:
    runs-on: ubuntu-latest
    steps:
      - name: Main process
        id: main
        run: |
          echo "Running main process"
          exit 1

      - name: Error notification
        if: failure()
        run: |
          echo "Main process failed"
          echo "Sending notification to team"

      - name: Cleanup
        if: always()
        run: |
          echo "Performing cleanup"
          echo "This runs regardless of previous step results"
